# ===========================================
# OpenAI Codex - AI Review Automático
# ===========================================
# Docs: https://github.com/openai/codex-action
# Requer: OPENAI_API_KEY de platform.openai.com (pago por uso)
# NOTA: Este workflow só roda se OPENAI_API_KEY estiver configurada
# SECURITY: Este workflow não usa inputs não confiáveis

name: Codex AI Review

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: write
  id-token: write

jobs:
  codex-review:
    # Só roda se OPENAI_API_KEY estiver configurada
    if: ${{ secrets.OPENAI_API_KEY != '' }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Codex Code Review
        uses: openai/codex-action@v1
        with:
          openai-api-key: ${{ secrets.OPENAI_API_KEY }}
          sandbox: read-only
          prompt: |
            Review this PR for code quality issues.
            Focus on bugs, security vulnerabilities, performance issues.
            Provide actionable suggestions in Portuguese Brazilian.
